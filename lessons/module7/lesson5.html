<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 5: JSON - JavaScript Journey</title>
    <link rel="stylesheet" href="../../styles/main.css">
    <link rel="stylesheet" href="../../styles/themes.css">
    <link rel="stylesheet" href="../../styles/lesson.css">
    <link rel="stylesheet" href="../../styles/dark-mode-fixes.css">
    <link rel="stylesheet" href="../../styles/code-highlighting.css">
    <link rel="stylesheet" href="../../styles/footer.css">
    <link rel="stylesheet" href="../../styles/header-enhanced.css">
    <link rel="stylesheet" href="../../styles/modal.css">
    <link rel="stylesheet" href="../../styles/style-guide.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="../../index.html" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-code"></i>
                    <span>JavaScript Journey</span>
                </a>
            </div>
            <div class="nav-menu">
                <button class="nav-btn" onclick="window.location.href='../../index.html'">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </button>
                <button class="nav-btn" id="progressBtn">
                    <i class="fas fa-chart-line"></i>
                    <span>Progress</span>
                </button>
                <button class="nav-btn" id="resetBtn">
                    <i class="fas fa-redo"></i>
                    <span>Reset</span>
                </button>
                <button class="nav-btn" id="themeBtn">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <main class="lesson-container">
        <article class="lesson-content">
            <!-- Lesson Header -->
            <div class="lesson-header">
                <h1>Module 7:<br>Lesson 5: JSON</h1>
                <p class="lesson-subtitle">Master JavaScript Object Notation - the universal language of data exchange on the web</p>
            </div>

            <!-- Introduction Section -->
            <section class="content-section">
                <h2>Introduction to JSON</h2>
                <p>Imagine you need to send a recipe to a friend, but they speak a different language. JSON (JavaScript Object Notation) is like a universal translator for data - it converts JavaScript objects into a text format that any programming language can understand, and then converts them back when needed. It's the postal service of the internet, ensuring data travels safely between different systems.</p>
                <p>JSON has become the standard format for data exchange on the web. When your weather app gets data from a server, when you save settings to local storage, or when APIs communicate - they're all likely using JSON. Understanding JSON is essential for modern web development.</p>
            </section>

            <!-- Core Content Section 1 -->
            <section class="content-section">
                <h2>What is JSON and Its Syntax Rules</h2>
                <p>JSON looks very similar to JavaScript objects, but it's actually a text format with strict rules. Think of JSON as JavaScript objects wearing a formal suit - they look familiar but follow stricter etiquette:</p>

                <div class="info-box">
                    <div>
                        <i class="fas fa-lightbulb"></i> <strong> Key Rules:</strong>
                        <p>JSON requires double quotes around property names and string values, doesn't support comments or undefined values, and can only contain basic data types.</p>
                    </div>
                </div>

                <div class="code-editor" id="editor1">
                    <div class="editor-header">
                        <div class="editor-tabs">
                            <button class="editor-tab active">JSON vs JavaScript</button>
                        </div>
                        <div class="editor-actions">
                            <button class="editor-btn copy-btn" onclick="copyCode('editor1')">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                            <button class="editor-btn run-btn" onclick="runCode('editor1')">
                                <i class="fas fa-play"></i> Run Code
                            </button>
                        </div>
                    </div>
                    <div class="editor-content">
                        <textarea class="code-input" id="editor1-code">
console.log("=== JavaScript Object ===");
// Regular JavaScript object (flexible syntax)
const jsObject = {
    name: 'Alice',           // Single quotes OK
    age: 28,                 // Numbers OK
    isActive: true,          // Booleans OK
    skills: ['JavaScript', 'Python', 'React'],  // Arrays OK
    address: {               // Nested objects OK
        city: 'Portland',
        state: 'OR'
    },
    // comments are fine
    manager: undefined,      // undefined is OK in JS objects
    startDate: new Date()    // Date objects OK
};

console.log("JavaScript object:", jsObject);

console.log("\n=== Valid JSON String ===");
// JSON string (strict syntax rules!)
const jsonString = `{
    "name": "Alice",
    "age": 28,
    "isActive": true,
    "skills": ["JavaScript", "Python", "React"],
    "address": {
        "city": "Portland",
        "state": "OR"
    },
    "startDate": "2023-01-15T10:30:00.000Z"
}`;

console.log("JSON string:", jsonString);

console.log("\n=== JSON Syntax Rules ===");
console.log("✅ Property names must be in double quotes");
console.log("✅ String values must be in double quotes");  
console.log("✅ Numbers, booleans, null, arrays, objects are allowed");
console.log("❌ No comments allowed");
console.log("❌ No undefined values");
console.log("❌ No functions or methods");
console.log("❌ No Date objects (must be strings)");
console.log("❌ No single quotes");

console.log("\n=== Common Data Types in JSON ===");
const validJSONExamples = {
    string: '"Hello World"',
    number: '42',
    boolean: 'true',
    nullValue: 'null',
    array: '[1, 2, 3]',
    object: '{"key": "value"}',
    nested: '{"users": [{"name": "John", "age": 30}]}'
};

console.log("Valid JSON examples:");
Object.entries(validJSONExamples).forEach(([type, example]) => {
    console.log(`${type}: ${example}`);
});
</textarea>
                        <div class="code-output">
                            <div class="output-label">Output will appear here...</div>
                            <pre id="editor1-output"></pre>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Core Content Section 2 -->
            <section class="content-section">
                <h2>JSON.stringify() - Converting Objects to JSON</h2>
                <p>JSON.stringify() is like a translator that converts JavaScript objects into JSON strings. It's your go-to method when you need to save data, send it over the network, or store it somewhere that only accepts text:</p>

                <div class="code-editor" id="editor2">
                    <div class="editor-header">
                        <div class="editor-tabs">
                            <button class="editor-tab active">JSON.stringify()</button>
                        </div>
                        <div class="editor-actions">
                            <button class="editor-btn copy-btn" onclick="copyCode('editor2')">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                            <button class="editor-btn run-btn" onclick="runCode('editor2')">
                                <i class="fas fa-play"></i> Run Code
                            </button>
                        </div>
                    </div>
                    <div class="editor-content">
                        <textarea class="code-input" id="editor2-code">
// Sample data to convert to JSON
const userData = {
    id: 1001,
    profile: {
        firstName: "Emma",
        lastName: "Johnson",
        email: "emma@example.com",
        age: 29
    },
    preferences: {
        theme: "dark",
        language: "en",
        notifications: true
    },
    friends: ["Alice", "Bob", "Charlie"],
    loginCount: 42,
    lastLogin: new Date('2024-01-15'),
    isActive: true,
    metadata: null
};

console.log("=== Basic JSON.stringify() ===");
const basicJSON = JSON.stringify(userData);
console.log("Stringified:", basicJSON);
console.log("Type:", typeof basicJSON);

console.log("\n=== Formatted JSON (Pretty Print) ===");
// Third parameter adds indentation for readability
const prettyJSON = JSON.stringify(userData, null, 2);
console.log("Pretty formatted:");
console.log(prettyJSON);

console.log("\n=== Selective Stringification ===");
// Second parameter lets you choose which properties to include
const selectedProperties = JSON.stringify(userData, ['id', 'profile', 'isActive'], 2);
console.log("Only selected properties:");
console.log(selectedProperties);

console.log("\n=== Custom Replacer Function ===");
// Second parameter can be a function to transform values
const customJSON = JSON.stringify(userData, function(key, value) {
    // Don't include email addresses for privacy
    if (key === 'email') return '[HIDDEN]';
    
    // Convert dates to readable strings
    if (key === 'lastLogin' && value instanceof Date) {
        return value.toISOString();
    }
    
    // Include all other values as-is
    return value;
}, 2);
console.log("With custom replacer:");
console.log(customJSON);

console.log("\n=== Handling Special Values ===");
const specialValues = {
    normalValue: "hello",
    undefinedValue: undefined,    // Will be omitted
    functionValue: function() {}, // Will be omitted
    symbolValue: Symbol('test'),  // Will be omitted
    nullValue: null,              // Will be included as "null"
    nanValue: NaN,               // Will become "null"
    infinityValue: Infinity      // Will become "null"
};

console.log("Original object:", specialValues);
console.log("Stringified:", JSON.stringify(specialValues, null, 2));

console.log("\n=== Real-World Examples ===");

// Saving game state
const gameState = {
    player: {
        name: "Hero",
        level: 15,
        health: 100,
        mana: 75
    },
    inventory: [
        { item: "sword", quantity: 1 },
        { item: "potion", quantity: 5 }
    ],
    currentStage: 7,
    score: 12500,
    timestamp: new Date().toISOString()
};

console.log("Game state to save:");
const gameStateJSON = JSON.stringify(gameState, null, 2);
console.log(gameStateJSON);

// Configuration object
const appConfig = {
    apiUrl: "https://api.example.com",
    version: "1.2.3",
    features: {
        darkMode: true,
        notifications: false,
        analytics: true
    },
    maxRetries: 3
};

console.log("\nApp configuration:");
console.log(JSON.stringify(appConfig, null, 2));
</textarea>
                        <div class="code-output">
                            <div class="output-label">Output will appear here...</div>
                            <pre id="editor2-output"></pre>
                        </div>
                    </div>
                </div>

                <div class="warning-box">
                    <div>
                        <i class="fas fa-exclamation-triangle"></i> <strong> Important:</strong>
                        <p>JSON.stringify() automatically removes functions, undefined values, and symbols from objects. Date objects become strings, so you'll need to convert them back when parsing.</p>
                    </div>
                </div>
            </section>

            <!-- Core Content Section 3 -->
            <section class="content-section">
                <h2>JSON.parse() - Converting JSON to Objects</h2>
                <p>JSON.parse() is the reverse translator - it takes JSON strings and converts them back into JavaScript objects. This is essential when you receive data from APIs, load saved settings, or read stored data:</p>

                <div class="code-editor" id="editor3">
                    <div class="editor-header">
                        <div class="editor-tabs">
                            <button class="editor-tab active">JSON.parse()</button>
                        </div>
                        <div class="editor-actions">
                            <button class="editor-btn copy-btn" onclick="copyCode('editor3')">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                            <button class="editor-btn run-btn" onclick="runCode('editor3')">
                                <i class="fas fa-play"></i> Run Code
                            </button>
                        </div>
                    </div>
                    <div class="editor-content">
                        <textarea class="code-input" id="editor3-code">
console.log("=== Basic JSON.parse() ===");

// JSON string from an API response
const apiResponseJSON = `{
    "status": "success",
    "data": {
        "products": [
            {
                "id": 1,
                "name": "Laptop",
                "price": 999.99,
                "inStock": true,
                "tags": ["electronics", "computers"]
            },
            {
                "id": 2,
                "name": "Mouse",
                "price": 24.99,
                "inStock": false,
                "tags": ["electronics", "peripherals"]
            }
        ],
        "total": 2
    },
    "timestamp": "2024-01-15T10:30:00.000Z"
}`;

console.log("Original JSON string:");
console.log(apiResponseJSON);

// Parse the JSON string back into a JavaScript object
const apiData = JSON.parse(apiResponseJSON);
console.log("\nParsed object:");
console.log(apiData);
console.log("Type:", typeof apiData);

// Now we can work with it like a normal JavaScript object
console.log("\n=== Working with Parsed Data ===");
console.log("Status:", apiData.status);
console.log("Total products:", apiData.data.total);
console.log("First product:", apiData.data.products[0].name);
console.log("First product price:", apiData.data.products[0].price);

console.log("\n=== Custom Reviver Function ===");

// JSON with date strings that we want to convert back to Date objects
const dataWithDates = `{
    "name": "John Doe",
    "createdAt": "2024-01-15T10:30:00.000Z",
    "updatedAt": "2024-01-16T15:45:30.000Z",
    "loginDates": [
        "2024-01-10T08:00:00.000Z",
        "2024-01-12T14:30:00.000Z",
        "2024-01-15T09:15:00.000Z"
    ],
    "age": 30
}`;

// Parse with a reviver function to convert date strings back to Date objects
const parsedWithDates = JSON.parse(dataWithDates, function(key, value) {
    // Check if the value looks like a date string
    if (typeof value === 'string' && /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/.test(value)) {
        return new Date(value);
    }
    return value;
});

console.log("Parsed with date conversion:");
console.log(parsedWithDates);
console.log("createdAt is now:", typeof parsedWithDates.createdAt);
console.log("Formatted date:", parsedWithDates.createdAt.toLocaleDateString());

console.log("\n=== Error Handling ===");

// Invalid JSON strings will throw errors
const invalidJSONStrings = [
    '{"name": "John", age: 30}',        // Missing quotes around property name
    "{'name': 'John'}",                 // Single quotes instead of double
    '{"name": "John", "age": 30,}',     // Trailing comma
    '{"name": "John" "age": 30}',       // Missing comma
    'undefined',                        // Invalid JSON value
];

invalidJSONStrings.forEach((jsonStr, index) => {
    try {
        const result = JSON.parse(jsonStr);
        console.log(`Valid JSON ${index + 1}:`, result);
    } catch (error) {
        console.log(`Invalid JSON ${index + 1}:`, error.message);
    }
});

console.log("\n=== Safe JSON Parsing Function ===");

function safeJSONParse(jsonString, fallback = null) {
    try {
        return JSON.parse(jsonString);
    } catch (error) {
        console.log("JSON parse error:", error.message);
        return fallback;
    }
}

// Test the safe parser
const testStrings = [
    '{"valid": true}',
    'invalid json',
    '{"another": "valid one"}'
];

testStrings.forEach(str => {
    const result = safeJSONParse(str, { error: "Invalid JSON" });
    console.log("Safe parse result:", result);
});

console.log("\n=== Real-World Example: Local Storage ===");

// Simulating saving and loading user preferences
const userPreferences = {
    theme: "dark",
    language: "en",
    fontSize: 16,
    autoSave: true,
    recentFiles: ["project1.js", "project2.js", "project3.js"]
};

console.log("Original preferences:", userPreferences);

// Save to "localStorage" (simulate with a variable)
const savedPrefs = JSON.stringify(userPreferences);
console.log("Saved as JSON:", savedPrefs);

// Load from "localStorage" (simulate)
const loadedPrefs = JSON.parse(savedPrefs);
console.log("Loaded preferences:", loadedPrefs);
console.log("Theme setting:", loadedPrefs.theme);
</textarea>
                        <div class="code-output">
                            <div class="output-label">Output will appear here...</div>
                            <pre id="editor3-output"></pre>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Practice Exercise 1 -->
            <section class="exercise-section">
                <div class="exercise-header">
                    <h3><i class="fas fa-puzzle-piece"></i> Practice Exercise 1: Save and Load Game State</h3>
                </div>
                <div class="exercise-content">
                    <p>Create a game state management system that can save and load player data using JSON:</p>
                    
                    <div class="code-editor" id="exercise1">
                        <div class="editor-header">
                            <div class="editor-tabs">
                                <button class="editor-tab active">Game State Manager</button>
                            </div>
                            <div class="editor-actions">
                                <button class="editor-btn copy-btn" onclick="copyCode('exercise1')">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                                <button class="editor-btn run-btn" onclick="checkExercise1()">
                                    <i class="fas fa-play"></i> Test Save/Load
                                </button>
                            </div>
                        </div>
                        <div class="editor-content">
                            <textarea class="code-input" id="exercise1-code">
const gameState = {
    player: {
        name: "Hero",
        level: 25,
        experience: 15750,
        health: 100,
        mana: 80
    },
    inventory: [
        { item: "Sword of Power", quantity: 1, type: "weapon" },
        { item: "Health Potion", quantity: 3, type: "consumable" },
        { item: "Magic Scroll", quantity: 2, type: "consumable" }
    ],
    currentLocation: "Mystic Forest",
    questsCompleted: 12,
    score: 45600,
    lastSaved: new Date('2024-01-15T14:30:00')
};

// Your task: Create functions to save and load game state

function saveGameState(gameData) {
    // Convert gameData to JSON string
    // Return the JSON string for "saving"
    
}

function loadGameState(jsonString) {
    // Parse the JSON string back to an object
    // Handle any parsing errors safely
    // Return the parsed object or null if invalid
    
}

function displayGameInfo(game) {
    // Display formatted game information
    console.log("=== Game State ===");
    console.log(`Player: ${game.player.name} (Level ${game.player.level})`);
    console.log(`Location: ${game.currentLocation}`);
    console.log(`Inventory: ${game.inventory.length} items`);
    console.log(`Score: ${game.score}`);
}

// Test your functions
console.log("Original game state:");
displayGameInfo(gameState);

console.log("\nSaving game...");
const savedGame = saveGameState(gameState);
console.log("Saved successfully:", savedGame ? "✅" : "❌");

console.log("\nLoading game...");
const loadedGame = loadGameState(savedGame);
if (loadedGame) {
    console.log("Loaded successfully:");
    displayGameInfo(loadedGame);
    
    // Test if data is intact
    console.log("\nData integrity check:");
    console.log("Player name matches:", loadedGame.player.name === gameState.player.name);
    console.log("Inventory count matches:", loadedGame.inventory.length === gameState.inventory.length);
} else {
    console.log("Failed to load game ❌");
}

// Test error handling with invalid JSON
console.log("\nTesting error handling...");
const invalidGame = loadGameState("invalid json string");
console.log("Invalid JSON handled:", invalidGame === null ? "✅" : "❌");
</textarea>
                            <div class="code-output">
                                <div class="output-label">Output will appear here...</div>
                                <pre id="exercise1-output"></pre>
                            </div>
                        </div>
                    </div>
                    <div class="exercise-feedback" id="exercise1-feedback"></div>
                </div>
            </section>

            <!-- Practice Exercise 2 -->
            <section class="exercise-section">
                <div class="exercise-header">
                    <h3><i class="fas fa-puzzle-piece"></i> Practice Exercise 2: JSON Format Quiz</h3>
                </div>
                <div class="exercise-content">
                    <p>Which of the following is valid JSON format?</p>
                    <div class="exercise-options" id="exercise2">
                        <button class="option-btn" data-answer="wrong">{'name': 'John', 'age': 25}</button>
                        <button class="option-btn" data-answer="correct">{"name": "John", "age": 25}</button>
                        <button class="option-btn" data-answer="wrong">{"name": "John", "age": 25,}</button>
                        <button class="option-btn" data-answer="wrong">{name: "John", age: 25}</button>
                    </div>
                    <div class="exercise-feedback" id="exercise2-feedback"></div>
                </div>
            </section>

            <!-- Practice Exercise 3 -->
            <section class="exercise-section">
                <div class="exercise-header">
                    <h3><i class="fas fa-puzzle-piece"></i> Practice Exercise 3: JSON Validator</h3>
                </div>
                <div class="exercise-content">
                    <p>Create a JSON validator that checks if a string is valid JSON and provides helpful error messages:</p>
                    
                    <div class="code-editor" id="exercise3">
                        <div class="editor-header">
                            <div class="editor-tabs">
                                <button class="editor-tab active">JSON Validator</button>
                            </div>
                            <div class="editor-actions">
                                <button class="editor-btn copy-btn" onclick="copyCode('exercise3')">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                                <button class="editor-btn run-btn" onclick="checkExercise3()">
                                    <i class="fas fa-play"></i> Test Validator
                                </button>
                            </div>
                        </div>
                        <div class="editor-content">
                            <textarea class="code-input" id="exercise3-code">
function validateJSON(jsonString) {
    // Your task: Create a function that:
    // 1. Tries to parse the JSON string
    // 2. Returns an object with 'isValid' boolean and 'message' string
    // 3. If valid: { isValid: true, message: "Valid JSON", data: parsedObject }
    // 4. If invalid: { isValid: false, message: "Error description" }
    
    
}

// Test cases for your validator
const testCases = [
    '{"name": "John", "age": 30}',           // Valid
    "{'name': 'John'}",                      // Invalid: single quotes
    '{"name": "John", "age": 30,}',          // Invalid: trailing comma  
    '{"name": "John" "age": 30}',            // Invalid: missing comma
    '[1, 2, 3, 4, 5]',                      // Valid array
    '{"users": [{"id": 1, "name": "Alice"}]}', // Valid nested
    'undefined',                             // Invalid value
    '{"function": function() {}}',           // Invalid: function (this will cause error)
    '{"valid": true, "number": 42}'          // Valid
];

console.log("=== JSON Validation Tests ===");

testCases.forEach((testCase, index) => {
    console.log(`\nTest ${index + 1}: ${testCase.substring(0, 30)}${testCase.length > 30 ? '...' : ''}`);
    
    const result = validateJSON(testCase);
    console.log(`Valid: ${result.isValid ? '✅' : '❌'}`);
    console.log(`Message: ${result.message}`);
    
    if (result.isValid && result.data) {
        console.log(`Data type: ${typeof result.data}`);
        console.log(`Data preview:`, result.data);
    }
});

// Bonus: Test with some edge cases
console.log("\n=== Edge Case Tests ===");
const edgeCases = [
    '',                    // Empty string
    'null',               // Valid JSON null
    'true',               // Valid JSON boolean
    '42',                 // Valid JSON number
    '"hello world"'       // Valid JSON string
];

edgeCases.forEach((testCase, index) => {
    console.log(`\nEdge case ${index + 1}: "${testCase}"`);
    const result = validateJSON(testCase);
    console.log(`Valid: ${result.isValid ? '✅' : '❌'} - ${result.message}`);
});
</textarea>
                            <div class="code-output">
                                <div class="output-label">Output will appear here...</div>
                                <pre id="exercise3-output"></pre>
                            </div>
                        </div>
                    </div>
                    <div class="exercise-feedback" id="exercise3-feedback"></div>
                </div>
            </section>

            <!-- Common Mistakes Section -->
            <section class="content-section">
                <h2>Common Mistakes to Avoid</h2>
                <div class="mistake-box">
                    <div class="mistake-item">
                        <div>
                            <i class="fas fa-times-circle"></i> <strong> Using Single Quotes in JSON</strong>
                            <p>JSON requires double quotes around property names and string values. Single quotes will cause JSON.parse() to throw an error. Always use double quotes in JSON strings.</p>
                        </div>
                    </div>
                    <div class="mistake-item">
                        <div>
                            <i class="fas fa-times-circle"></i> <strong> Not Handling JSON.parse() Errors</strong>
                            <p>JSON.parse() throws an error for invalid JSON. Always wrap it in a try-catch block or create a safe parsing function to handle malformed JSON gracefully.</p>
                        </div>
                    </div>
                    <div class="mistake-item">
                        <div>
                            <i class="fas fa-times-circle"></i> <strong> Forgetting that Dates Become Strings</strong>
                            <p>Date objects are converted to ISO strings in JSON. When you parse them back, they remain strings. Use a reviver function or manually convert them back to Date objects if needed.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Summary Section -->
            <section class="content-section">
                <h2>Summary</h2>
                <div class="summary-box">
                    <h3>Key Takeaways:</h3>
                    <ul>
                        <li>JSON is a text format for data exchange that follows strict syntax rules with double quotes</li>
                        <li>JSON.stringify() converts JavaScript objects to JSON strings, with optional formatting and filtering</li>
                        <li>JSON.parse() converts JSON strings back to JavaScript objects, with optional transformation</li>
                        <li>Always handle JSON.parse() errors with try-catch blocks for robust applications</li>
                        <li>JSON is essential for APIs, data storage, configuration files, and communication between systems</li>
                    </ul>
                </div>
            </section>

            <!-- Spacing before navigation -->
            <div style="margin: 2rem 0;"></div>
            
            <!-- Lesson Navigation -->
            <div class="lesson-navigation">
                <button class="btn btn-secondary" onclick="window.location.href='lesson4.html'">
                    <i class="fas fa-arrow-left"></i> Previous Lesson
                </button>
                
                <button class="btn btn-primary" onclick="completeLesson()">
                    Complete Module 7 <i class="fas fa-check"></i>
                </button>
                
                <button class="btn btn-secondary" onclick="window.location.href='../module8/index.html'">
                    Start Module 8 <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </article>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <p>Made by TayMcQuaya with <span class="heart">❤️</span></p>
            <div class="social-links">
                <a href="https://taymcquaya.com" target="_blank" rel="noopener noreferrer" aria-label="Personal Website">
                    <i class="fas fa-globe"></i>
                </a>
                <a href="https://x.com/TayMcQuaya" target="_blank" rel="noopener noreferrer" aria-label="X (Twitter)">
                    <i class="fa-brands fa-x-twitter"></i>
                </a>
                <a href="https://github.com/TayMcQuaya" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
                    <i class="fab fa-github"></i>
                </a>
            </div>
            <div class="copyright">
                <p>&copy; 2025 JavaScript Journey&trade; - All rights reserved</p>
            </div>
        </div>
    </footer>

    <!-- Reset Modal -->
    <div class="modal" id="resetModal">
        <div class="modal-content">
            <h3>Reset Progress</h3>
            <p>Choose what you want to reset:</p>
            <div class="modal-buttons">
                <button class="btn btn-danger" id="resetAllBtn">Reset All Progress</button>
                <button class="btn btn-warning" id="resetModuleBtn">Reset Current Module</button>
                <button class="btn btn-secondary" id="cancelResetBtn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../../js/app.js"></script>
    <script src="../../js/storage.js"></script>
    <script src="../../js/navigation.js"></script>
    <script src="../../js/progress.js"></script>
    <script src="../../js/exercises.js"></script>
    <script src="../../js/modal.js"></script>
    <script>
        // Complete lesson function
        function completeLesson() {
            Storage.saveProgress(7, 5, true);
            customModal.success('🎉 Congratulations! You have completed Module 7: Objects! You now understand objects, methods, the this keyword, destructuring, and JSON - the fundamental building blocks of modern JavaScript applications.', 'Module 7 Complete!');
            
            setTimeout(() => {
                if (typeof app !== 'undefined' && app.startNextModule) {
                    app.startNextModule(7);
                } else {
                    // Fallback navigation
                    window.location.href = '../module8/index.html';
                }
            }, 3000);
        }

        // Copy code function
        function copyCode(editorId) {
            const codeInput = document.getElementById(`${editorId}-code`);
            if (!codeInput) return;
            
            codeInput.select();
            codeInput.setSelectionRange(0, 99999);
            
            try {
                document.execCommand('copy');
                const button = event.target.closest('.editor-btn');
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i> Copied!';
                setTimeout(() => {
                    button.innerHTML = originalText;
                }, 2000);
            } catch (err) {
                console.error('Failed to copy:', err);
            }
        }

        // Run code function
        function runCode(editorId) {
            const codeInput = document.getElementById(`${editorId}-code`);
            const outputPane = document.getElementById(`${editorId}-output`);
            
            if (!codeInput || !outputPane) return;
            
            const code = codeInput.value;
            
            // Clear the parent container to remove the "Output will appear here..." label
            const outputContainer = outputPane.parentElement;
            const outputLabel = outputContainer.querySelector('.output-label');
            if (outputLabel) {
                outputLabel.style.display = 'none';
            }
            
            outputPane.innerHTML = '';
            
            const originalConsoleLog = console.log;
            const logs = [];
            
            console.log = (...args) => {
                logs.push(args.map(arg => {
                    if (typeof arg === 'object') {
                        return JSON.stringify(arg, null, 2);
                    }
                    return String(arg);
                }).join(' '));
            };
            
            try {
                eval(code);
                
                if (logs.length > 0) {
                    outputPane.innerHTML = logs.map(log => 
                        `<div class="output-line">${escapeHtml(log)}</div>`
                    ).join('');
                } else {
                    outputPane.innerHTML = '<div class="output-line muted">No output</div>';
                }
            } catch (error) {
                outputPane.innerHTML = `<div class="output-error">Error: ${escapeHtml(error.message)}</div>`;
            } finally {
                console.log = originalConsoleLog;
            }
        }

        // Escape HTML function
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Exercise 1 checker
        function checkExercise1() {
            const code = document.getElementById('exercise1-code').value;
            const output = document.getElementById('exercise1-output');
            const feedback = document.getElementById('exercise1-feedback');
            
            // Clear the parent container to remove the "Output will appear here..." label
            const outputContainer = output.parentElement;
            const outputLabel = outputContainer.querySelector('.output-label');
            if (outputLabel) {
                outputLabel.style.display = 'none';
            }
            
            // Run the code first to show output
            runCode('exercise1');
            
            // Check if the output contains any errors
            const outputHasError = output.innerHTML.includes('output-error') || 
                                  output.innerHTML.includes('Error:');
            
            const hasSaveFunction = code.includes('JSON.stringify') && code.includes('saveGameState');
            const hasLoadFunction = code.includes('JSON.parse') && code.includes('loadGameState');
            const hasErrorHandling = code.includes('try') && code.includes('catch');
            const hasReturnStatements = code.includes('return') && code.match(/return/g).length >= 2;
            
            // Hide feedback first to create animation effect
            feedback.style.display = 'none';
            feedback.className = 'exercise-feedback';
            feedback.classList.remove('show', 'success', 'error');
            
            setTimeout(() => {
                feedback.style.display = 'block';
                if (!outputHasError && hasSaveFunction && hasLoadFunction && hasErrorHandling && hasReturnStatements) {
                    feedback.className = 'exercise-feedback show success';
                    feedback.textContent = 'Perfect! Your game state manager properly saves and loads data using JSON, with proper error handling. This is exactly how real games manage save files!';
                } else if (outputHasError) {
                    feedback.className = 'exercise-feedback show error';
                    feedback.textContent = 'Your code has errors. Make sure both functions are properly implemented and handle the JSON operations correctly.';
                } else {
                    feedback.className = 'exercise-feedback show error';
                    let missing = [];
                    if (!hasSaveFunction) missing.push('JSON.stringify in saveGameState');
                    if (!hasLoadFunction) missing.push('JSON.parse in loadGameState');
                    if (!hasErrorHandling) missing.push('error handling (try/catch)');
                    if (!hasReturnStatements) missing.push('proper return statements');
                    feedback.textContent = `Missing: ${missing.join(', ')}. Make sure both functions work with JSON and handle errors.`;
                }
            }, 150);
        }

        // Exercise 3 checker
        function checkExercise3() {
            const code = document.getElementById('exercise3-code').value;
            const output = document.getElementById('exercise3-output');
            const feedback = document.getElementById('exercise3-feedback');
            
            // Clear the parent container to remove the "Output will appear here..." label
            const outputContainer = output.parentElement;
            const outputLabel = outputContainer.querySelector('.output-label');
            if (outputLabel) {
                outputLabel.style.display = 'none';
            }
            
            // Run the code first to show output
            runCode('exercise3');
            
            // Check if the output contains any errors
            const outputHasError = output.innerHTML.includes('output-error') || 
                                  output.innerHTML.includes('Error:');
            
            const hasJSONParse = code.includes('JSON.parse');
            const hasTryCatch = code.includes('try') && code.includes('catch');
            const hasReturnObject = code.includes('isValid') && code.includes('message');
            const hasValidCase = code.includes('true') && code.includes('data');
            const hasInvalidCase = code.includes('false');
            
            // Hide feedback first to create animation effect
            feedback.style.display = 'none';
            feedback.className = 'exercise-feedback';
            feedback.classList.remove('show', 'success', 'error');
            
            setTimeout(() => {
                feedback.style.display = 'block';
                if (!outputHasError && hasJSONParse && hasTryCatch && hasReturnObject && hasValidCase && hasInvalidCase) {
                    feedback.className = 'exercise-feedback show success';
                    feedback.textContent = 'Excellent! Your JSON validator properly handles both valid and invalid JSON with helpful error messages. This is a valuable utility function!';
                } else if (outputHasError) {
                    feedback.className = 'exercise-feedback show error';
                    feedback.textContent = 'Your code has errors. Make sure the validator function properly handles JSON parsing and returns the correct object structure.';
                } else {
                    feedback.className = 'exercise-feedback show error';
                    let missing = [];
                    if (!hasJSONParse) missing.push('JSON.parse usage');
                    if (!hasTryCatch) missing.push('error handling (try/catch)');
                    if (!hasReturnObject) missing.push('return object with isValid and message');
                    if (!hasValidCase) missing.push('valid case handling');
                    if (!hasInvalidCase) missing.push('invalid case handling');
                    feedback.textContent = `Missing: ${missing.join(', ')}. Your function should validate JSON and return appropriate feedback.`;
                }
            }, 150);
        }

        // Exercise 2 - Multiple choice handler
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.option-btn').forEach(button => {
                button.addEventListener('click', function() {
                    if (this.disabled) return;
                    
                    const exerciseContainer = this.closest('.exercise-options');
                    const feedbackDiv = this.closest('.exercise-content').querySelector('.exercise-feedback');
                    const isCorrect = this.getAttribute('data-answer') === 'correct';
                    
                    // Remove previous incorrect selections (but not correct ones)
                    exerciseContainer.querySelectorAll('.option-btn').forEach(btn => {
                        if (btn.classList.contains('incorrect')) {
                            btn.classList.remove('incorrect', 'selected');
                            btn.disabled = false;
                        }
                    });
                    
                    // Hide feedback first to create animation effect
                    if (feedbackDiv) {
                        feedbackDiv.style.display = 'none';
                        feedbackDiv.className = 'exercise-feedback';
                        feedbackDiv.classList.remove('show', 'success', 'error');
                    }
                    
                    // Mark this button
                    this.classList.add('selected');
                    this.classList.add(isCorrect ? 'correct' : 'incorrect');
                    
                    if (isCorrect) {
                        // Correct answer - disable all buttons
                        exerciseContainer.querySelectorAll('.option-btn').forEach(btn => {
                            btn.disabled = true;
                        });
                    } else {
                        // Wrong answer - disable only this button
                        this.disabled = true;
                    }
                    
                    // Show feedback with animation
                    if (feedbackDiv) {
                        setTimeout(() => {
                            feedbackDiv.style.display = 'block';
                            feedbackDiv.className = 'exercise-feedback show ' + (isCorrect ? 'success' : 'error');
                            if (isCorrect) {
                                feedbackDiv.textContent = 'Correct! JSON requires double quotes around property names and string values, and no trailing commas.';
                            } else {
                                feedbackDiv.textContent = 'Not quite. JSON has strict formatting rules: double quotes only, no trailing commas, and quoted property names.';
                            }
                        }, 150);
                    }
                });
            });
        });
    </script>
</body>
</html>